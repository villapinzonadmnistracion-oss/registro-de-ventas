<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Punto Secreto - Registro de Ventas</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        background: #f8faf9;
        height: 100vh;
        overflow: hidden;
      }

      /* Header minimalista */
      .header {
        background: white;
        border-bottom: 1px solid #e8f5e9;
        padding: 16px 40px;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.03);
      }

      .logo {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
      }

      .header h1 {
        font-size: 1.5em;
        color: #059669;
        font-weight: 700;
        letter-spacing: -0.5px;
      }

      /* Layout principal */
      .workspace {
        max-width: 1800px;
        margin: 0 auto;
        padding: 24px 40px;
        display: grid;
        grid-template-columns: 580px 1fr;
        gap: 24px;
        height: calc(100vh - 73px);
      }

      /* Panel izquierdo - Formulario principal */
      .main-panel {
        display: flex;
        flex-direction: column;
        gap: 16px;
        overflow-y: auto;
        padding-right: 8px;
      }

      .main-panel::-webkit-scrollbar {
        width: 6px;
      }

      .main-panel::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }

      .main-panel::-webkit-scrollbar-thumb {
        background: #10b981;
        border-radius: 10px;
      }

      /* Panel derecho - Productos y resumen */
      .side-panel {
        background: white;
        border-radius: 16px;
        padding: 24px;
        border: 1px solid #e5e7eb;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      /* Tarjetas limpias */
      .card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        border: 1px solid #e5e7eb;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
      }

      .card:hover {
        border-color: #d1fae5;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.08);
      }

      .section-title {
        font-size: 1.1em;
        font-weight: 700;
        color: #047857;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      /* Formularios */
      .form-row {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        align-items: end;
      }

      .form-group {
        margin-bottom: 14px;
      }

      .form-group label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: #047857;
        font-size: 13px;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 10px 14px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.2s;
        background: white;
        color: #1f2937;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #10b981;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
      }

      /* Botones modernos */
      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        justify-content: center;
        font-family: inherit;
      }

      .btn-primary {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      }

      .btn-primary:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: white;
        color: #059669;
        border: 2px solid #d1fae5;
      }

      .btn-secondary:hover {
        background: #f0fdf4;
        border-color: #10b981;
      }

      .btn-success {
        background: #10b981;
        color: white;
        width: 100%;
        padding: 14px;
        font-size: 15px;
      }

      .btn-success:hover {
        background: #059669;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      }

      .btn-danger {
        background: #ef4444;
        color: white;
        padding: 8px 14px;
        font-size: 13px;
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      .btn-registrar-cliente {
        background: #3b82f6;
        color: white;
        text-decoration: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: all 0.2s;
        font-size: 14px;
      }

      .btn-registrar-cliente:hover {
        background: #2563eb;
        transform: translateY(-1px);
      }

      /* Alertas */
      .alert {
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 16px;
        display: none;
        font-size: 13px;
        font-weight: 500;
      }

      .alert.show {
        display: flex;
        align-items: center;
        gap: 8px;
        animation: slideDown 0.3s ease;
      }

      .alert-success {
        background: #d1fae5;
        color: #047857;
        border: 1px solid #a7f3d0;
      }

      .alert-error {
        background: #fee2e2;
        color: #dc2626;
        border: 1px solid #fecaca;
      }

      .alert-info {
        background: #dbeafe;
        color: #1e40af;
        border: 1px solid #bfdbfe;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Info de cliente */
      .cliente-info,
      .cliente-no-encontrado {
        background: #f0fdf4;
        padding: 16px;
        border-radius: 10px;
        margin: 16px 0;
        display: none;
        border: 1px solid #d1fae5;
      }

      .cliente-info.show,
      .cliente-no-encontrado.show {
        display: block;
        animation: slideDown 0.3s ease;
      }

      .cliente-info h3 {
        color: #047857;
        margin-bottom: 12px;
        font-size: 1em;
      }

      .cliente-no-encontrado {
        background: #fef3c7;
        border: 1px solid #fde68a;
      }

      .cliente-no-encontrado h3 {
        color: #d97706;
      }

      .cliente-info p,
      .cliente-no-encontrado p {
        margin: 8px 0;
        font-size: 14px;
        color: #374151;
      }

      /* Loading */
      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .loading.show {
        display: block;
      }

      .spinner {
        border: 3px solid #e5e7eb;
        border-top: 3px solid #10b981;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        animation: spin 0.8s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Selector de tipo de transacci√≥n */
      .transaction-selector {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 16px;
      }

      .transaction-option {
        position: relative;
      }

      .transaction-option input[type="radio"] {
        position: absolute;
        opacity: 0;
      }

      .transaction-option label {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 12px;
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        font-weight: 600;
        gap: 6px;
        color: #6b7280;
        font-size: 14px;
      }

      .transaction-option input[type="radio"]:checked + label {
        border-color: #10b981;
        background: #f0fdf4;
        color: #047857;
      }

      .transaction-option label:hover {
        border-color: #10b981;
      }

      /* Lista de productos con scroll */
      .productos-lista {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin: 14px 0;
        max-height: 280px;
        overflow-y: auto;
        padding-right: 6px;
      }

      .productos-lista::-webkit-scrollbar {
        width: 6px;
      }

      .productos-lista::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }

      .productos-lista::-webkit-scrollbar-thumb {
        background: #10b981;
        border-radius: 10px;
      }

      .productos-lista::-webkit-scrollbar-thumb:hover {
        background: #059669;
      }

      .producto-item {
        display: grid;
        grid-template-columns: 2fr 1fr auto;
        gap: 10px;
        padding: 12px;
        background: #f9fafb;
        border-radius: 8px;
        align-items: center;
        border: 1px solid #e5e7eb;
      }

      .producto-item:hover {
        border-color: #d1fae5;
        background: #f0fdf4;
      }

      .producto-item .form-group {
        margin: 0;
      }

      .producto-item .form-group label {
        font-size: 12px;
        margin-bottom: 4px;
      }

      .producto-item .form-group input {
        padding: 8px 10px;
        font-size: 13px;
      }

      /* Resumen de venta */
      .summary {
        background: #f0fdf4;
        padding: 16px;
        border-radius: 10px;
        margin-top: auto;
        border: 1px solid #d1fae5;
      }

      .summary-title {
        font-size: 1.1em;
        font-weight: 700;
        color: #047857;
        margin-bottom: 12px;
      }

      .summary-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        font-size: 14px;
        color: #374151;
      }

      .summary-row.total {
        border-top: 2px solid #10b981;
        margin-top: 10px;
        padding-top: 12px;
        font-size: 20px;
        font-weight: 700;
        color: #047857;
      }

      /* Actions */
      .actions {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 16px;
      }

      .devolucion-item {
        padding: 12px;
        border: 2px solid #fb923c;
        border-radius: 8px;
        margin: 8px 0;
        background: #fff7ed;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      small {
        color: #6b7280;
        font-size: 12px;
        display: block;
        margin-top: 4px;
      }

      #devolucionesList {
        max-height: 150px;
        overflow-y: auto;
      }

      #devolucionesList::-webkit-scrollbar {
        width: 6px;
      }

      #devolucionesList::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }

      #devolucionesList::-webkit-scrollbar-thumb {
        background: #fb923c;
        border-radius: 10px;
      }

      .productos-scroll-container {
        flex: 1;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 14px;
        padding-right: 6px;
      }

      .productos-scroll-container::-webkit-scrollbar {
        width: 6px;
      }

      .productos-scroll-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }

      .productos-scroll-container::-webkit-scrollbar-thumb {
        background: #10b981;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="logo">üåø</div>
      <h1>Punto Secreto</h1>
    </div>

    <!-- Workspace -->
    <div class="workspace">
      <!-- Panel izquierdo: Cliente y configuraci√≥n -->
      <div class="main-panel">
        <div class="alert alert-error" id="alertError">
          ‚ùå Error al registrar la venta
        </div>
        <div class="alert alert-info" id="alertInfo"></div>

        <!-- Buscar Cliente -->
        <div class="card">
          <div class="section-title">üîç Buscar Cliente</div>
          <div class="form-row">
            <div class="form-group" style="margin: 0;">
              <label for="rutCliente">RUT del Cliente</label>
              <input
                type="text"
                id="rutCliente"
                placeholder="12.345.678-9"
                onkeypress="buscarClienteEnter(event)"
                oninput="formatearRUT(this)"
              />
            </div>
            <button class="btn btn-primary" onclick="buscarCliente()">
              Buscar
            </button>
          </div>

          <div class="cliente-info" id="clienteInfo">
            <h3>‚úÖ Cliente Encontrado</h3>
            <p><strong>Nombre:</strong> <span id="clienteNombre"></span></p>
            <p><strong>Tel√©fono:</strong> <span id="clienteTelefono"></span></p>
            <p><strong>RUT:</strong> <span id="clienteRUT"></span></p>
          </div>

          <div class="cliente-no-encontrado" id="clienteNoEncontrado">
            <h3>‚ö†Ô∏è Cliente No Registrado</h3>
            <p>El RUT no est√° en la base de datos.</p>
            <a
              href="https://admnistracionpsecreto233-spec.github.io/formulario-clientes/"
              target="_blank"
              class="btn-registrar-cliente"
            >
              ‚ûï Registrar Cliente
            </a>
          </div>

          <div class="loading" id="loading">
            <div class="spinner"></div>
            <p style="margin-top: 10px; color: #047857; font-weight: 600; font-size: 13px;">Buscando...</p>
          </div>
        </div>

        <!-- Vendedor -->
        <div id="anfitrionContainer" style="display: none;">
          <div class="card">
            <div class="section-title">üë§ Vendedor</div>
            <div class="form-group" style="margin: 0;">
              <label for="anfitrionSelect">Seleccionar Anfitri√≥n</label>
              <select id="anfitrionSelect">
                <option value="">Seleccionar...</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Tipo de transacci√≥n -->
        <div id="transactionTypeContainer" style="display: none;">
          <div class="card">
            <div class="section-title">üìã Tipo de Transacci√≥n</div>
            <div class="transaction-selector">
              <div class="transaction-option">
                <input type="radio" id="ventaRadio" name="tipoTransaccion" value="venta" checked onchange="cambiarTipoTransaccion('venta')">
                <label for="ventaRadio">üì§ Venta</label>
              </div>
              <div class="transaction-option">
                <input type="radio" id="devolucionRadio" name="tipoTransaccion" value="devolucion" onchange="cambiarTipoTransaccion('devolucion')">
                <label for="devolucionRadio">üì• Devoluci√≥n</label>
              </div>
            </div>
          </div>
        </div>

        <!-- Notas -->
        <div id="notasContainer" style="display: none;">
          <div class="card">
            <div class="section-title">üìù Observaciones</div>
            <div class="form-group" style="margin: 0;">
              <label for="notas">Notas u observaciones</label>
              <textarea
                id="notas"
                placeholder="Detalles adicionales de la transacci√≥n..."
                rows="2"
              ></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- Panel derecho: Productos y resumen -->
      <div class="side-panel" id="productosContainer" style="display: none;">
        <div class="section-title">üõçÔ∏è Productos</div>

        <div class="productos-scroll-container">
          <!-- Ventas -->
          <div id="ventasSection">
            <div class="form-group">
              <label for="codigoProducto">C√≥digo de Barras</label>
              <input
                type="text"
                id="codigoProducto"
                placeholder="Escanear c√≥digo..."
                autofocus
                onkeypress="procesarCodigoProducto(event)"
              />
              <small>üí° Escanea o escribe el c√≥digo y presiona Enter</small>
            </div>

            <div class="form-group">
              <label for="selectProductoManual">O seleccionar manualmente</label>
              <select id="selectProductoManual" onchange="agregarProductoManual()">
                <option value="">Seleccionar producto...</option>
                <option value="Polera">Polera</option>
                <option value="Poler√≥n">Poler√≥n</option>
                <option value="Parka">Parka</option>
                <option value="Falda">Falda</option>
                <option value="Bluza">Bluza</option>
                <option value="Pantal√≥n">Pantal√≥n</option>
                <option value="Jean">Jean</option>
                <option value="Buzo">Buzo</option>
                <option value="Abrigo">Abrigo</option>
                <option value="Polar">Polar</option>
                <option value="Su√©ter">Su√©ter</option>
                <option value="Chaleco">Chaleco</option>
                <option value="Vestido">Vestido</option>
                <option value="Short">Short</option>
                <option value="Ropa de cama">Ropa de cama</option>
                <option value="Otro">Otro</option>
              </select>
            </div>

            <div class="productos-lista" id="productosLista">
              <div class="producto-item">
                <div class="form-group">
                  <label>Producto</label>
                  <input type="text" class="producto-nombre" placeholder="Nombre del producto">
                </div>
                <div class="form-group">
                  <label>Precio</label>
                  <input
                    type="number"
                    class="producto-precio"
                    placeholder="0"
                    min="0"
                    onchange="calcularTotal()"
                  />
                </div>
                <button
                  class="btn btn-danger"
                  onclick="eliminarProducto(this)"
                >
                  üóëÔ∏è
                </button>
              </div>
            </div>

            <button
              class="btn btn-secondary"
              onclick="agregarProducto()"
              style="width: 100%;"
            >
              ‚ûï Agregar Producto
            </button>
          </div>

          <!-- Devoluciones -->
          <div id="devolucionesSection" style="display: none;">
            <div class="form-group">
              <label for="codigoDevolucion">Escanear Producto a Devolver</label>
              <input
                type="text"
                id="codigoDevolucion"
                placeholder="Escanear c√≥digo..."
                onkeypress="procesarCodigoDevolucion(event)"
                style="border-color: #fb923c;"
              />
              <small style="color: #ea580c;">üí° Escanea cada producto devuelto</small>
            </div>
            <div id="devolucionesList"></div>
          </div>

          <!-- Descuento -->
          <div class="form-group">
            <label for="descuento">üí∏ Descuento (%)</label>
            <input
              type="number"
              id="descuento"
              placeholder="0"
              min="0"
              max="100"
              value="0"
              onchange="calcularTotal()"
            />
          </div>
        </div>

        <!-- Resumen -->
        <div class="summary">
          <div class="summary-title">Resumen</div>
          <div class="summary-row">
            <span>Subtotal</span>
            <span id="subtotal">$0</span>
          </div>
          <div class="summary-row">
            <span>Descuento</span>
            <span id="descuentoMonto">$0</span>
          </div>
          <div class="summary-row total">
            <span>Total</span>
            <span id="total">$0</span>
          </div>
        </div>

        <!-- Acciones -->
        <div class="actions">
          <button class="btn btn-success" onclick="registrarVenta()">
            ‚úÖ Registrar Transacci√≥n
          </button>
          <button class="btn btn-secondary" onclick="limpiarFormulario()">
            üîÑ Nueva Transacci√≥n
          </button>
        </div>

        <div class="alert alert-success" id="alertSuccess" style="margin-top: 12px;">
          ‚úÖ Transacci√≥n registrada exitosamente
        </div>
      </div>
    </div>

    <script src="./main.js"></script>
  </body>
</html>